<%attr>
  title => 'GIT Collaboration Howto'
</%attr>

<h1>OpenXPKI GIT Collaboration Howto</h1>
<p>
OpenXPKI uses Subversion as primary and authoritative source code 
control system. Keeping this repository in a clean state should be the 
primary goal of all developers.
</p>
<p>
However, this central approach reduces the possible interaction
between developers: if one of them is working on some highly 
experimental code, it is frequently not desirable to check in this 
code into the repository. It would "pollute" the clean state and 
possibly break things that used to work. In this state the developer
can only work alone on his personal source, nobody can help him properly.
</p>
<p>
The main idea now is to continue using Subversion for the official checkins,
i. e. development stages that are consistent within themselves (at least
the automatic tests still run properly).
</p>
<p>
The dirty work gets offloaded to a <em>second</em> source code control
system that works separately from Subversion and that allows ad-hoc
collaboration: <a href="http://git.or.cz/">GIT</a>.
</p>

<h2>Collaboration models</h2>
<p>
One way around this problem is to use GIT as a localized version
control system <em>in addition to</em> Subversion. This document should
help developers setting up their local Subversion OpenXPKI repositories
for collaboration use with GIT.
</p>
<p>
The OpenXPKI project supports three possible "development modes" for
contributors:
</p>
<dl>
  <dt>Subversion only</dt>
  <dd>Good old way of contributing code to OpenXPKI. You are not
    doing anything wrong this way. If you are happy, why are you
    reading this document at all...?
  </dd>
  <dt>Subversion plus GIT</dt>
  <dd>
    Ideal for small teams collaborating on experimental features,
    yielding maximum efficience without "polluting" the official
    repository. This is appropriate if you are a registered 
    OpenXPKI developer yourself.
  </dd>
  <dt>GIT only</dt>
  <dd>Suitable for non-permanent developers or contributors. The easiest
    way if you plan to collaborate with another developer who has already 
    created and published an own GIT repository of OpenXPKI. 
  </dd>
</dl>

<h2>Common prerequisites</h2>
<p>
These steps should be performed if you wish to use GIT with OpenXPKI
regardless of collaboration model.
</p>
<p>
Set up proper author name and email address:
</p>
<pre>
$ export GIT_AUTHOR_EMAIL="johndoe@example.com"
$ export GIT_AUTHOR_NAME="John Doe"
</pre>
<p>
You can also set these values within the GIT repository (in which case
they only apply to this single repository) by adding the following
to .git/config
</p>
<pre>
[user]
        email = johndoe@example.com
        name = "John Doe"
</pre>

<h2>Subversion plus GIT</h2>
<p>
We will assume that you have checked out OpenXPKI in your directory
src/openxpki:
</p>
<pre>
$ cd src
$ svn co https://johndoe@svn.sourceforge.net/svnroot/openxpki openxpki
</pre>
<p>
Change into the base directory of the OpenXPKI checkout (src/openxpki in
our example) and create the GIT index:
</p>
<pre>
$ cd openxpki
$ git-init-db
</pre>
<p>
When working on OpenXPKI with both SVN and GIT we don't want to clutter
GIT with SVN files (and vice-versa). So we add an exclude stance for GIT:
</p>
<pre>
$ echo "*.svn" &gt;&gt;.git/info/exclude
</pre>
<p>
Now let's add and commit the checked-out files to the GIT repository.
</p>
<pre>
$ git add trunk
$ git add www.openxpki.org
$ git commit
</pre>
<p>
This command checked in the local files to your GIT repositor into the
"master" branch.
</p>
<p>
Add remote GIT repositories for all people you want to collaborate with:
</p>
<pre>
$ mkdir .git/remotes
$ cat &lt;&lt;EOF &gt;.git/remotes/martin
URL: http://www.cynops.de/oss/OpenXPKI/openxpki.git/
Pull: master:incoming-martin
EOF
</pre>
<p>
You are now ready to fetch or pull changes from the remote repositories,
e. g. from the "martin" remote we created above:
</p>
<pre>
$ git fetch martin
</pre>
<p>
The changes "martin" published will now show up in your local 
branch "incoming-martin".
</p>
<p>
In order to allow others to get your own changes you have to publish
your GIT repository. You will have to set up a publicly available GIT 
repository to make this possible. Only you will need write access anybody
else needs read-only access. We will assume that you will publish via
ssh and that others get access via HTTP.
</p>
<p>
On the publicly available system create the remote repository 
directory and create the GIT infrastructure:
</p>
<pre>
remote$ cd...
remote$ mkdir -p git/openxpki.git
remote$ cd git
remote$ GIT_DIR=openxpki.git git-init-db
</pre>
<p>
Configure your system to provide read-only access to ...git/openxpki.git
for the public via HTTP.
</p>
<p>
Now add your own remote repository to your local git remotes:
</p>
<pre>
cat &lt;&lt;EOF &gt;.git/remotes/mypublic
URL: ssh://johndoe@somehost.example.com/path/to/openxpki.git/
Push: master:master
EOF
</pre>
<p>
And finally push your local directory to the public repository:
</p>
<pre>
$ git push mypublic
</pre>

<h2>GIT only</h2>
<p>
For GIT-only-mode you can skip the Subversion checkout. Instead choose
a GIT repository to clone from and run:
</p>
<pre>
$ git clone http://somehost.example.com/....git/openxpki.git
</pre>
<p>
This automatically sets up GIT to pull from this repository to the "origin"
branch (check the .git/remotes/origin file for this). Setting up
public repository replicas basically works the same as outlined in the above
section.
</p>


