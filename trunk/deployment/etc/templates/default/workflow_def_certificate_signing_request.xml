<workflow>
  <type>I18N_OPENXPKI_WF_TYPE_CERTIFICATE_SIGNING_REQUEST</type>
  <description>I18N_OPENXPKI_WF_DESC_CERTIFICATE_SIGNING_REQUEST</description>
  <persister>OpenXPKI</persister>

  <state name="INITIAL">
    <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_SIGNING_REQUEST_INITIAL</description>
    <action name="create_csr" 
	    resulting_state="PENDING">
      <condition name="ACL::create_csr"/>
    </action>
  </state>

  <state name="PENDING">
    <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_SIGNING_REQUEST_PENDING</description>
    <action name="I18N_OPENXPKI_WF_ACTION_CHANGE_CSR_ROLE"
	    resulting_state="PENDING">
      <condition name="ACL::change_csr_role"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_CHANGE_CSR_PROFILE"
	    resulting_state="PENDING">
      <condition name="ACL::change_csr_profile"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_CHANGE_CSR_SUBJECT_STYLE"
	    resulting_state="PENDING">
      <condition name="ACL::change_csr_subject_style"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_CHANGE_CSR_SUBJECT"
	    resulting_state="PENDING">
      <condition name="ACL::change_csr_subject"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_CHANGE_CSR_SUBJECT_ALT_NAME"
	    resulting_state="PENDING">
      <condition name="ACL::change_csr_subject_alt_name"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_CHANGE_CSR_INFO"
	    resulting_state="PENDING">
      <condition name="ACL::change_csr_info"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_APPROVE_CSR"
	    resulting_state="APPROVED">
      <condition name="ACL::approve_csr"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_REJECT_CSR"
	    resulting_state="REJECTED">
      <condition name="ACL::reject_csr"/>
    </action>
  </state>

  <state name="APPROVED">
    <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_SIGNING_REQUEST_APPROVED</description>
    <action name="I18N_OPENXPKI_WF_ACTION_EXECUTE_CSR"
	    resulting_state="EXECUTED">
      <condition name="ACL::execute_csr"/>
      <condition name="Workflow::check_csr_approvals"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_CANCEL_CSR_APPROVAL"
	    resulting_state="PENDING">
      <condition name="ACL::cancel_csr_approval"/>
    </action>
    <action name="I18N_OPENXPKI_WF_ACTION_REJECT_CSR"
	    resulting_state="REJECTED">
      <condition name="ACL::reject_csr"/>
    </action>
  </state>

  <state name="REJECTED" />
  <state name="EXECUTED" />
</workflow>
