<%args>
    $profile   => undef
    $config_nr => undef
    $CONFIG    => undef
</%args>
<& /service/open_form.mhtml &>
<& /lib/html/hidden.mhtml, 'name' => 'profile', 'value' => $profile &>

<h1><% i18nGettext ('I18N_OPENXPKI_CLIENT_HTML_MASON_CREATE_CSR_GET_TYPE_TITLE') %></h1>
<p>
  <% i18nGettext('I18N_OPENXPKI_CLIENT_HTML_MASON_CREATE_CSR_GET_TYPE_DESCRIPTION') %>
</p>
<select name="config_nr">
%   for (my $i=0; $i < scalar @{$CONFIG}; $i++)
%   {
%       next if (not exists $types{$CONFIG->[$i]->{NAME}});
  <option value="<% $i %>">
    <% i18nGettext($types{$CONFIG->[$i]->{NAME}}->{LABEL}) %>
  </option>
%   }
</select>
<& /service/send_form.mhtml &>
<& /service/close_form.mhtml &>
<dl>
%
%   foreach my $type (sort keys %types)
%   {
  <dt><% i18nGettext($types{$type}->{LABEL}) %></dt>
  <dd><% i18nGettext($types{$type}->{DESCRIPTION}) %></dd>
%   }
</dl>
<%init>
    ## load available subject profiles from server
    my $msg = $context->{client}->send_receive_command_msg (
                   "get_cert_subject_profiles",
                   {PROFILE => $profile});
    my %types = %{$msg->{PARAMS}};

    ## return the configuration number if it exists
    return $config_nr
        if (defined $config_nr and
            exists $CONFIG->[$config_nr] and
            grep $CONFIG->[$config_nr]->{NAME}, keys %types);

    ## if we have only one configuration
    ## then we have not to ask the user
    return 0 if (scalar @{$CONFIG} == 1);

    ## ok, we have to ask the user
</%init>
