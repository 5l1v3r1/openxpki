<%args>
  $session_id  => undef
  $pki_realm   => undef
  $auth_stack  => undef
  $auth_stacks => undef
</%args>

<%perl>
    ## if pki realm is not in the session cache
    ## then ask the user
    if (not exists $session_cache{$session_id}->{auth_stack})
    {
</%perl>
        <div class="title">
            <% i18nGettext ('I18N_OPENXPKI_CLIENT_HTML_MASON_GET_AUTHENTICATION_STACK_TITLE') %>
        </div>
        <div class="description">
            <% i18nGettext ('I18N_OPENXPKI_CLIENT_HTML_MASON_GET_AUTHENTICATION_STACK_DESCRIPTION') %>
        </div>
        <select name="auth_stack">
<%perl>
        ## let's print the available options
        foreach my $stack (keys %{$auth_stacks})
        {
            print "  <option value='$stack'>".
                  $auth_stacks->{$stack}->{NAME}." - ".
                  $auth_stacks->{$stack}->{DESCRIPTION}.
                  "</option>\n";
        }
</%perl>
        </select>
<%perl>
    }
</%perl>

<%init>
    ## check if the pki realm is already present
    return $session_cache{$session_id}->{auth_stack}
        if (exists $session_cache{$session_id}->{auth_stack});
</%init>
