<%init>
  my $CONFIG = {
                NESTED => 1,
                ROLE =>
                {
                    'anonymous' =>
                    {
                        MENU => "anonymous_menu"
                    },
                    'RA Operator' =>
                    {
                        MENU => "ra_op_menu"
                    }
                },
                MENU =>
                {
                    "anonymous_menu" =>
                    [
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_CREATE_CSR",
                                   "create_csr"],
                        ["MENU",   "I18N_OPENXPKI_HTML_MENU_WORKFLOW",
                                   "workflow"],
                        ["MENU",   "I18N_OPENXPKI_HTML_MENU_LANGUAGE",
                                   "language"],
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_LOGOUT",
                                   "logout"]
                    ],
                    "ra_op_menu" =>
                    [
                        ["MENU",   "I18N_OPENXPKI_HTML_MENU_CERTS",  "edit_certs"],
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_LOGOUT", "logout"]
                    ],
                    "workflow" =>
                    [
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_WORKFLOW_LIST_TYPES",
                                   "workflow_list_types"],
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_WORKFLOW_CREATE_INSTANCE",
                                   "workflow_create_instance"],
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_WORKFLOW_LIST_INSTANCES",
                                   "workflow_list_instances"],
                    ],
                    "language" =>
                    [
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_LANGUAGE_EN_GB",
                                   "set_language_en_gb"],
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_LANGUAGE_DE_DE",
                                   "set_language_de_de"],
                    ],
                    "edit_certs" =>
                    [
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_VALID_CERTS",   "edit_valid_certs"],
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_EXPIRED_CERTS", "edit_expired_certs"],
                        ["ACTION", "I18N_OPENXPKI_HTML_MENU_REVOKED_CERTS", "edit_revoked_certs"],
                    ]
                },
                ACTION =>
                {
                    "create_csr" =>
                    {
                        CMD => "service/create_csr/index.html"
                    },
                    "workflow_list_types" =>
                    {
                        CMD => "service/workflow_list_types.html"
                    },
                    "workflow_list_instances" =>
                    {
                        CMD => "service/workflow_list_instances.html"
                    },
                    "workflow_create_instance" =>
                    {
                        CMD => "service/workflow_create_instance.html"
                    },
                    "set_language_en_gb" =>
                    {
                        CMD    => "service/index.html",
                        PARAMS => { "__language" => "en_GB" }
                    },
                    "set_language_de_de" =>
                    {
                        CMD    => "service/index.html",
                        PARAMS => { "__language" => "de_DE" }
                    },
                    "edit_valid_certs" =>
                    {
                        CMD => "service/cert_list.html",
                        PARAMS =>
                        {
                            "STATUS"        => "VALID",
                            "REVOKE_BUTTON" => "YES",
                            "RENEW_BUTTON"  => "YES"
                        }
                    },
                    "edit_expired_certs" =>
                    {
                        CMD => "service/cert_list.html",
                        PARAMS =>
                        {
                            "STATUS"        => "VALID",
                            "REVOKE_BUTTON" => "YES",
                            "RENEW_BUTTON"  => "YES"
                        }
                    },
                    "edit_revoked_certs" =>
                    {
                        CMD => "service/cert_list.html",
                        PARAMS =>
                        {
                            "STATUS"        => "REVOKED",
                            "REVOKE_BUTTON" => "NO",
                            "RENEW_BUTTON"  => "NO"
                        }
                    },
                    "logout" =>
                    {
                        CMD => "service/logout.html"
                    }
                }
               };

  my %params = ( MASON  => $m,
                 CONFIG => $CONFIG,
                 ACTION => "service/index.html",
                 COMP   => $m->request_comp()->title() );

  foreach my $key ("ROLE", "SESSION_ID", "LANGUAGE")
  {
      $params{$key} = $context->{lc $key} if (exists $context->{lc $key});
  }
  $context->{menu} = OpenXPKI::Client::HTML::Mason::Menu->new(\%params);
</%init>
<% $context->{menu}->get() %>
<%flags>
  inherit => '/syshandler'
</%flags>
