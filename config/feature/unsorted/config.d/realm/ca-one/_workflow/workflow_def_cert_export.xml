<!-- 
  Generated by: tools/scripts/ogflow.pl 

     File: core/config/graffle/workflow_cert_export.graffle
  Version: 1.0
-->


<workflow>
    <type>I18N_OPENXPKI_WF_TYPE_CERT_EXPORT</type>
    <description>I18N_OPENXPKI_WF_DESC_CERT_EXPORT</description>
    <persister>OpenXPKI</persister>

    <state name="INITIALIZED"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_INITIALIZED</description>
        <action name="cert_export_get_config" resulting_state="READY_TO_PROCESS">
        </action>
    </state>

    <state name="INITIAL">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_INITIAL</description>
        <action name="cert_export_initialize" resulting_state="INITIALIZED">
        </action>
    </state>

    <state name="EXPORT_DONE"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_EXPORT_DONE</description>
        <action name="cert_export_null1" resulting_state="SUCCESS">
            <condition name="!cert_export_have_certs_to_transfer"/>
        </action>
        <action name="cert_export_null2" resulting_state="READY_TO_TRANSFER">
            <condition name="cert_export_have_certs_to_transfer"/>
        </action>
    </state>

    <state name="FAILURE">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_FAILURE</description>
    </state>

    <state name="READY_TO_PROCESS"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_READY_TO_PROCESS</description>
        <action name="cert_export_generate_export_file" resulting_state="CHECK_EXPORT">
        </action>
    </state>

    <state name="CHECK_TRANSFER"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_CHECK_TRANSFER</description>
        <action name="cert_export_null1" resulting_state="TRANSFER_DONE">
            <condition name="cert_export_transfer_successful"/>
        </action>
        <action name="cert_export_null2" resulting_state="FAILURE">
            <condition name="!cert_export_transfer_successful"/>
        </action>
    </state>

    <state name="SUCCESS">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_SUCCESS</description>
    </state>

    <state name="READY_TO_TRANSFER"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_READY_TO_TRANSFER</description>
        <action name="cert_export_transfer_export_file" resulting_state="CHECK_TRANSFER">
        </action>
    </state>

    <state name="CHECK_EXPORT"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_CHECK_EXPORT</description>
        <action name="cert_export_null1" resulting_state="FAILURE">
            <condition name="!cert_export_export_successful"/>
        </action>
        <action name="cert_export_null2" resulting_state="EXPORT_DONE">
            <condition name="cert_export_export_successful"/>
        </action>
    </state>

    <state name="TRANSFER_DONE"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_TRANSFER_DONE</description>
        <action name="cert_export_tag_certs_as_exported" resulting_state="CHECK_TAGGING">
        </action>
    </state>

    <state name="CHECK_TAGGING"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERT_EXPORT_CHECK_TAGGING</description>
        <action name="cert_export_null1" resulting_state="READY_TO_PROCESS">
            <condition name="cert_export_tagging_successful"/>
        </action>
        <action name="cert_export_null2" resulting_state="FAILURE">
            <condition name="!cert_export_tagging_successful"/>
        </action>
    </state>

</workflow>
