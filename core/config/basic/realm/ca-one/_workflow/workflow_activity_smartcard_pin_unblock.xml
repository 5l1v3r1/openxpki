<!-- Generated by "tools/scripts/ogflow.pl " -->


<actions>

    <action name="scunblock_post_codes"
            class="Workflow::Action::Null">
            <field name="_auth1_code" is_required="yes"/>
            <field name="_auth2_code" is_required="yes"/>
    </action>

    <action name="scunblock_generate_activation_code"
            class="OpenXPKI::Server::Workflow::Activity::SmartCard::GenerateActivationCode">
    </action>

    <action name="scunblock_initialize"
        class="OpenXPKI::Server::Workflow::Activity::Tools::SetContext"
        SetContextParameters="overwritecontext"
        auth1_id=""
        auth2_id=""
        auth1_cn=""
        auth2_cn=""
        auth1_hash=""
        auth2_hash=""
        auth1_mail=""
        auth2_mail=""
        _auth1_code=""
        _auth2_code=""
        owner_cn=""
        owner_mail=""        
        _password=""        
        _puk=""
        num_tries=""
        wfl_notify="">
        <description>Initialize the Workflow</description>
        <field name="token_id"
            label="Token ID"
            description="Smartcard Token ID"
            is_required="yes">
        </field>
    </action>

    <action name="scpu_notify_auth_contact" 
        class="OpenXPKI::Server::Workflow::Activity::Tools::Notify"        
        message="scpu_notify"
        _map_auth1_name="$auth1_cn"
        _map_auth1_mail="$auth1_mail"
        _map_auth2_name="$auth2_cn"
        _map_auth2_mail="$auth2_mail"
        _map_requestor_mail="$owner_mail"
        _map_requestor_name="$owner_cn"
        _map_openxpki_url="https://ldev-user-ca.tools.intranet.db.com">       
    </action>

    <action name="scunblock_store_auth_ids"
            class="Workflow::Action::Null">
            <field name="auth1_id" is_required="yes"/>
            <field name="auth2_id" is_required="yes"/>
    </action>

    <action name="scunblock_user_abort"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetErrorCode">
            <field name="error_code" is_required="yes"/>
    </action>

    <action name="scunblock_get_auth1_id"
        class="OpenXPKI::Server::Workflow::Activity::Tools::Connector::GetValue"                       
        ds_key_template="users.by_mail.[% CONTEXT.auth1_id %]"      
        ds_value_map="auth1_mail -> mail, auth1_cn -> cn">  
    </action>

    <action name="scunblock_get_auth2_id"
        class="OpenXPKI::Server::Workflow::Activity::Tools::Connector::GetValue"                       
        ds_key_template="users.by_mail.[% CONTEXT.auth2_id %]"
        ds_value_map="auth2_mail -> mail, auth2_cn -> cn">  
    </action>
     
    <action name="scunblock_fetch_puk"
            class="OpenXPKI::Server::Workflow::Activity::SmartCard::FetchPUK"
            ds_key_param="token_id"
            ds_namespace="smartcard.puk"
            ds_value_param="_puk">
            <description>Fetch PUK from datapool</description>
            <field name="token_id" is_required="yes"/>
    </action>

    <action name="scunblock_auth_ldap_err"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetErrorCode"
            error_code="Auth persons not accepted">
    </action>

    <action name="scunblock_write_pin_ok"
            class="Workflow::Action::Null">
    </action>

    <action name="scunblock_reset_ldap_err"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetErrorCode"
            error_code="">
    </action>

    <action name="scunblock_write_pin_nok"
            class="Workflow::Action::Null">
            <field name="error_code" is_required="yes"/>
    </action>

    <action name="scunblock_set_creator"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetContext"
            SetContextParameters="overwritecontext,extendedsyntax"
            creator="$context->param('owner_mail');">
            <description>Copy value in ldap_mail from LDAP and overwrite the creator parameter in the workflow</description>
    </action>

    <action name="scunblock_get_user_data"
            class="OpenXPKI::Server::Workflow::Activity::SmartCard::GetOwnerByCardID">
        <description>Obtain user data by querying the connector.</description>  
    </action>

    <action name="scunblock_null1" class="Workflow::Action::Null"/>
    <action name="scunblock_null2" class="Workflow::Action::Null"/>
</actions>
