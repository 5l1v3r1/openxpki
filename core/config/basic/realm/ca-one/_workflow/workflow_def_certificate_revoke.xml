<!-- 
  Generated by: tools/scripts/ogflow.pl 

     File: core/config/graffle/workflow_certificate_revoke.graffle
  Version: 
      Git: 3be89618398e3ef7b3e9447f2cb656f7768defe4 (modified)
-->


<workflow>
    <type>I18N_OPENXPKI_WF_TYPE_CERTIFICATE_REVOKE</type>
    <description>I18N_OPENXPKI_WF_DESC_CERTIFICATE_REVOKE</description>
    <persister>OpenXPKI</persister>

    <state name="INITIAL">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_INITIAL</description>
        <action name="certrevoke_initialize" resulting_state="INITIALIZED">
        </action>
    </state>

    <state name="SUCCESS">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_SUCCESS</description>
    </state>

    <state name="INITIALIZED"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_INITIALIZED</description>
        <action name="certrevoke_initialize_context_params" resulting_state="INITIALIZED_PARAMS">
        </action>
    </state>

    <state name="HAVE_CERT_TO_REVOKE"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_HAVE_CERT_TO_REVOKE</description>
        <action name="certrevoke_revoke_certificate" resulting_state="CERTS_QUEUED_FOR_REVOCATION">
        </action>
    </state>

    <state name="CERTS_QUEUED_FOR_REVOCATION"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_CERTS_QUEUED_FOR_REVOCATION</description>
        <action name="certrevoke_cleanup_workflow" resulting_state="SUCCESS">
            <condition name="certrevoke_all_certs_revoked"/>
        </action>
        <action name="certrevoke_null1" resulting_state="CERT_TO_REVOKE">
            <condition name="!certrevoke_all_certs_revoked"/>
        </action>
    </state>

    <state name="CERT_TO_REVOKE"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_CERT_TO_REVOKE</description>
        <action name="certrevoke_next_cert_to_revoke" resulting_state="HAVE_CERT_TO_REVOKE">
        </action>
    </state>

    <state name="PREREQS_AVAILABLE"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_PREREQS_AVAILABLE</description>
        <action name="certrevoke_null1" resulting_state="REQUESTER_AUTHORIZED">
            <condition name="certrevoke_requester_authorized"/>
        </action>
        <action name="certrevoke_null2" resulting_state="AUTO_REVOKE_EXISTING_CERTIFICATES">
            <condition name="!certrevoke_requester_authorized"/>
        </action>
    </state>

    <state name="AUTO_REVOKE_EXISTING_CERTIFICATES"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_AUTO_REVOKE_EXISTING_CERTIFICATES</description>
        <action name="certrevoke_queue_certs_to_revoke" resulting_state="SET_REVOKE_PARAMS">
        </action>
    </state>

    <state name="INITIALIZED_PARAMS"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_INITIALIZED_PARAMS</description>
        <action name="certrevoke_add_cert_to_queue" resulting_state="PREREQS_AVAILABLE">
        </action>
    </state>

    <state name="REQUESTER_AUTHORIZED"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_REQUESTER_AUTHORIZED</description>
        <action name="certrevoke_null1" resulting_state="AUTO_REVOKE_EXISTING_CERTIFICATES">
            <condition name="!certrevoke_policy_allows_auto_revoke"/>
        </action>
        <action name="certrevoke_set_auto_approval_to_true" resulting_state="AUTO_REVOKE_EXISTING_CERTIFICATES">
            <condition name="certrevoke_policy_allows_auto_revoke"/>
        </action>
    </state>

    <state name="SET_REVOKE_PARAMS"
            autorun="yes">
        <description>I18N_OPENXPKI_WF_STATE_CERTIFICATE_REVOKE_SET_REVOKE_PARAMS</description>
        <action name="certrevoke_set_revoke_params" resulting_state="CERTS_QUEUED_FOR_REVOCATION">
        </action>
    </state>

</workflow>
