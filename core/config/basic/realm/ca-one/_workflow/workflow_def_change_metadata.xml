<workflow>
    <type>I18N_OPENXPKI_WF_TYPE_CHANGE_METADATA</type>
    <description>I18N_OPENXPKI_WF_DESC_CHANGE_METADATA</description>
    <persister>OpenXPKI</persister>
    
    <state name="INITIAL">
        <description>I18N_OPENXPKI_WF_STATE_CHANGE_METADATA_INITIAL</description>
        <action name="global_initialize_workflow" resulting_state="INITIALIZED">
        </action>
    </state>
    
    <state name="INITIALIZED">
        <description>I18N_OPENXPKI_WF_STATE_CHANGE_METADATA_INITIAL</description>
        <action name="changemeta_load_data" resulting_state="DATA_LOADED">
        </action>
    </state>
    
    <state name="DATA_LOADED" uihandle="OpenXPKI::Client::UI::Workflow::Metadata::render_current_data">
        <description>I18N_OPENXPKI_WF_STATE_CHANGE_METADATA_LOADED</description>        
        <action name="changemeta_load_form" resulting_state="DATA_UPDATE"/>
               
        <action name="changemeta_persist" resulting_state="SUCCESS">
           <condition name="changemeta_cond_has_update"/>        
        </action>
        
        <action name="changemeta_terminate" resulting_state="SUCCESS">
           <condition name="!changemeta_cond_has_update"/>        
        </action>
    </state>
    
    <state name="DATA_UPDATE">
        <description>I18N_OPENXPKI_WF_STATE_CHANGE_METADATA_UPDATE</description>        
        <action name="changemeta_update_context" resulting_state="DATA_LOADED">
        </action>        
    </state>
    
    <state name="FAILURE">
        <description>I18N_OPENXPKI_WF_STATE_CHANGE_METADATA_FAILURE</description>
    </state>
    <state name="SUCCESS">
        <description>I18N_OPENXPKI_WF_STATE_CHANGE_METADATA_SUCCESS</description>
    </state>

</workflow>
