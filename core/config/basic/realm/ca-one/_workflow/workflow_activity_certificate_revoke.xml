<!-- 
  Generated by: tools/scripts/ogflow.pl 

     File: core/config/graffle/workflow_certificate_revoke.graffle
  Version: 
      Git: 3be89618398e3ef7b3e9447f2cb656f7768defe4 (modified)
-->


<actions>

    <action name="certrevoke_revoke_certificate"
            class="OpenXPKI::Server::Workflow::Activity::Tools::RevokeCertificate">
            <field name="cert_identifier" is_required="yes"/>
    </action>

    <action name="certrevoke_initialize"
            class="Workflow::Action::Null">
            <field name="cert_id" is_required="yes"/>
            <field name="client_ip"/>
            <field name="issuing_ca"/>
            <field name="requester_authorized" is_required="yes"/>
            <field name="requester_sn" is_required="yes"/>
            <field name="serial_num"/>
    </action>

    <action name="certrevoke_add_cert_to_queue"
            class="OpenXPKI::Server::Workflow::Activity::Tools::WFArray"
            array_name="certs_to_revoke"
            context_key="cert_id"
            function="push">
            <field name="cert_id" is_required="yes"/>
    </action>

    <action name="certrevoke_next_cert_to_revoke"
            class="OpenXPKI::Server::Workflow::Activity::Tools::WFArray"
            array_name="tmp_queue"
            context_key="cert_identifier"
            function="shift">
            <field name="tmp_queue" is_required="yes"/>
    </action>

    <action name="certrevoke_cleanup_workflow"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetContext"
            SetContextParameters="overwritecontext"
            _keypassword="OpenXPKI"
            tmp_queue="">
    </action>

    <action name="certrevoke_queue_certs_to_revoke"
            class="OpenXPKI::Server::Workflow::Activity::Tools::WFArray"
            array_name="tmp_queue"
            context_key="certs_to_revoke"
            function="pusharray">
            <field name="certs_to_revoke"/>
    </action>

    <action name="certrevoke_initialize_context_params"
            class="OpenXPKI::Server::Workflow::Activity::Tools::Connector::GetValue"
            ds_key_template="realm.[% PKI_REALM %].cert_revoke.policy.auto_approve"
            ds_value_param="flag_crr_auto_approval">
    </action>

    <action name="certrevoke_set_auto_approval_to_true"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetContext"
            SetContextParameters="overwritecontext"
            flag_crr_auto_approval="1">
    </action>

    <action name="certrevoke_set_revoke_params"
            class="OpenXPKI::Server::Workflow::Activity::Tools::SetContext"
            SetContextParameters="overwritecontext,extendedsyntax"
            comment="q(Automated revocation request)"
            invalidity_time="time()"
            reason_code="q(cessationOfOperation)">
    </action>

    <action name="certrevoke_null1" class="Workflow::Action::Null"/>
    <action name="certrevoke_null2" class="Workflow::Action::Null"/>
</actions>
